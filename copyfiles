#!/bin/bash
# Copy WolfProxy source and config files for remote building
# (C) 2026 Wolf Software Systems Ltd

# Files needed to build and run wolfproxy
FILES="src Cargo.toml install_service.sh install.sh wolfproxy.toml wolfproxy.toml.example build.sh run.sh LICENSE README.md"

# Target servers
SERVERS=(
    "root@100.123.22.10:/mnt/shared/wolfproxy"
    "root@wolf-grid.com:/root/wolfproxy"
    "root@100.83.218.9:/mnt/shared/wolfproxy"
)

echo "WolfProxy Remote Deployment"
echo "==========================="
echo ""

# Create remote directories and cleanup targets
echo "Preparing remote directories..."
for target in "${SERVERS[@]}"; do
    server="${target%:*}"
    path="${target#*:}"
    echo "  Creating $server:$path and cleaning target..."
    ssh "$server" "mkdir -p $path && rm -rf $path/target" 2>/dev/null || true
done
echo ""

# Sync to all servers
for target in "${SERVERS[@]}"; do
    server="${target%:*}"
    path="${target#*:}"
    echo "Syncing to $server:$path..."
    scp -r $FILES "$target/"
done

echo ""
echo "Done!"
echo ""
echo "To install on remote server:"
echo "  1. SSH to the server"
echo "  2. cd to wolfproxy directory"
echo "  3. Run: ./install.sh"
echo ""
echo "Or manually:"
echo "  cargo build --release"
echo "  sudo ./install_service.sh"
